{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js","webpack:///external \"ratchet/web\""],"names":["getModule","Ratchet","observable","get","registeredModules","ehModule","i","l","length","mod","id","moduleId","debounce","fn","delay","timeout","args","arguments","clearTimeout","setTimeout","apply","getEnvUrl","env","timestamp","modUrl","window","location","origin","getEnvFromBranch","branch","title","startsWith","getEnvFromSessionStorage","Storage","sessionStorage","getItem","loadEnvScript","currentProject","currentBranch","getId","process","originalExecIndex","AbstractOneTeamPage","prototype","executeIndex","queuedExecIndexCalls","overriddenExecuteIndex","push","context","onLoad","forEach","requirejs","loadEnv","reload","newBranch","currentBranchId","_doc","newBranchId","loadingTheSameBranch","subscribe"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","/* globals requirejs */\r\n\r\nimport Ratchet from 'ratchet/web';\r\nimport { name as moduleId } from './module.json';\r\n\r\nfunction getModule() {\r\n  const {\r\n    'registered-modules': registeredModules\r\n  } = Ratchet.observable('oneteamApplication').get();\r\n  \r\n  let ehModule;\r\n  \r\n  for (let i = 0, l = registeredModules.length; i < l; i += 1) {\r\n    const mod = registeredModules[i];\r\n  \r\n    if (mod.id === moduleId) {\r\n      ehModule = mod;\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ehModule;\r\n}\r\n\r\nfunction debounce(fn, delay) {\r\n  let timeout;\r\n\r\n  return function() {\r\n    let args = arguments;\r\n\r\n    if (timeout) {\r\n      clearTimeout(timeout);\r\n    }\r\n\r\n    timeout = setTimeout(() => fn.apply(null, args), delay);\r\n  };\r\n}\r\n\r\nfunction getEnvUrl(env, mod) {\r\n  const {\r\n    id,\r\n    timestamp\r\n  } = mod;\r\n  \r\n  const modUrl = `${window.location.origin}/_modules-${timestamp}/${id}`;\r\n  return `${modUrl}/${env}.js`;\r\n}\r\n\r\nfunction getEnvFromBranch(branch) {\r\n  const { title } = branch;\r\n\r\n  if (title.startsWith('DEV: ') || title.startsWith('Pre-Production - ')) {\r\n    return 'preproduction';\r\n  }\r\n\r\n  if (title.startsWith('PR: ')) {\r\n    return 'prs';\r\n  }\r\n\r\n  if (title.startsWith('STAGING: ')) {\r\n    return 'staging';\r\n  }\r\n\r\n  return 'production';\r\n}\r\n\r\nfunction getEnvFromSessionStorage() {\r\n  if (typeof Storage !== 'undefined') {\r\n    return window.sessionStorage.getItem('moduleEnv');\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\nfunction loadEnvScript() {\r\n  const ehModule = getModule();\r\n\r\n  if (!ehModule) {\r\n    return;\r\n  }\r\n\r\n  const currentProject = Ratchet.observable('project').get();\r\n  const currentBranch = Ratchet.observable('branch').get();\r\n\r\n  if (!(currentProject\r\n    && (currentProject.getId() === process.env.CLOUDCMS_PROJECT_ID)\r\n    && currentBranch\r\n  )) {\r\n    return;\r\n  }\r\n\r\n  const env = getEnvFromSessionStorage() || getEnvFromBranch(currentBranch);\r\n\r\n  const originalExecIndex = Ratchet.AbstractOneTeamPage.prototype.executeIndex;\r\n  const queuedExecIndexCalls = [];\r\n\r\n  Ratchet.AbstractOneTeamPage.prototype.executeIndex = function overriddenExecuteIndex(...args) {\r\n    queuedExecIndexCalls.push({\r\n      context: this,\r\n      args\r\n    });\r\n  };\r\n\r\n  const onLoad = () => {\r\n    queuedExecIndexCalls.forEach(({\r\n      context,\r\n      args\r\n    }) => {\r\n      originalExecIndex.apply(context, args);\r\n    });\r\n\r\n    Ratchet.AbstractOneTeamPage.prototype.executeIndex = originalExecIndex;\r\n  };\r\n\r\n  requirejs([getEnvUrl(env, ehModule)], onLoad, onLoad);\r\n}\r\n\r\nfunction loadEnv() {\r\n  let currentBranch = Ratchet.observable('branch').get();\r\n\r\n  const reload = debounce((newBranch) => {\r\n    const currentBranchId = currentBranch && currentBranch._doc;\r\n    const newBranchId = newBranch && newBranch._doc;\r\n    const loadingTheSameBranch = currentBranchId === newBranchId;\r\n\r\n    if (!newBranch || loadingTheSameBranch) {\r\n      return;\r\n    }\r\n  \r\n    // Super janky, but triggering a refresh to ensure UI is updated with overrides\r\n    // and to clear out any of our modules js from the previous branch\r\n    window.location.reload();\r\n  }, 100);\r\n  \r\n  Ratchet.subscribe('branch', reload);\r\n\r\n  loadEnvScript();\r\n}\r\n\r\nloadEnv();\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE_ratchet_web__;"],"sourceRoot":""}